<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<f:view>

    <ui:composition template="../fragments/masterLayout.xhtml">


        <ui:define name="mainContents">

            <h:form prependId="false">

                <h:panelGrid columns="1">

                    <p:panel header="Patient File :#{fileDetailsBean.file.fileID} Details">

                        <p:toolbar>
                            <p:toolbarGroup align="left">
                                <!--<p:commandButton value="Change Status" action="CHANGESTATUS"
                                                 ajax="false" icon="fa-hand-o-right"/>-->
                                <a class="btn btn-danger" href="ChangeFile.xhtml?id=#{fileDetailsBean.file.fileID}">Change Status</a>
                            </p:toolbarGroup>
                        </p:toolbar>

                        <p:panelGrid columns="2">

                            <p:outputLabel value="File Number"/>
                            <p:outputLabel value="#{fileDetailsBean.file.fileID}"/>
                            <p:outputLabel value="Patient Name"/>
                            <p:outputLabel value="#{fileDetailsBean.file.patientName}"/>
                            <p:outputLabel value="Patient Number"/>
                            <p:outputLabel value="#{fileDetailsBean.file.patientNumber}"/>
                            <p:outputLabel value="Clinic Name"/>
                            <p:outputLabel value="#{fileDetailsBean.file.currentStatus.appointment.clinicName}"/>
                            <p:outputLabel value="Requesting Doc Name"/>
                            <p:outputLabel value="#{fileDetailsBean.file.currentStatus.appointment.requestingDocName}"/>
                            <p:outputLabel value="File's State"/>
                            <p:outputLabel value="#{fileDetailsBean.file.currentStatus.readableState}"/>
                            <p:outputLabel value="Archive Cabinet"/>
                            <p:outputLabel value="#{fileDetailsBean.file.archiveCabinet.cabinetID}"/>
                            <p:outputLabel value="Shelf ID"/>
                            <p:outputLabel value="#{fileDetailsBean.file.shelfId}"/>
                            <p:outputLabel value="Latest Batch Number"/>
                            <p:outputLabel value="#{fileDetailsBean.file.currentStatus.appointment.batchRequestNumber}"/>


                        </p:panelGrid>
                    </p:panel>

                    <p:separator/>

                    <p:panel header="File History Details">


                        <p:dataTable id="historiesTable" var="history" value="#{fileDetailsBean.fileHistories}"
                                     paginator="true" rowKey="#{history}" paginatorTemplate="{CurrentPageReport}  {FirstPageLink}
                         {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     sortBy="#{history.createdAt}"
                                     rows="10"
                                     >

                            <f:facet name="header">
                                <b> Total History Steps(<font color="red">#{fileDetailsBean.fileHistories.size()}</font>)</b>
                            </f:facet>

                            <p:column headerText="Clinic Code" filterable="true" filterMatchMode="contains"
                                      sortable="true">
                                <h:panelGrid columns="2" rendered="#{history.appointment.inpatient}">
                                   <h:graphicImage url="../img/in-patient.png" rendered="#{history.appointment.inpatient}"/>
                                <p:outputLabel value="#{history.appointment.clinicCode}"/>
                                </h:panelGrid>
                                <p:outputLabel value="#{history.appointment.clinicCode}" rendered="#{!history.appointment.inpatient}"/>
                            </p:column>

                            <p:column headerText="Clinic/Ward Name" filterable="true" filterMatchMode="contains"
                                      >
                                <p:outputLabel value="#{history.appointment.clinicName}"/>
                            </p:column>

                            <p:column headerText="Trolley ID" filterable="true"
                                      filterMatchMode="contains">
                                <p:outputLabel value="#{history.containerId}"/>
                            </p:column>

                            <p:column headerText="Status" filterable="true" filterMatchMode="contains"
                                     >
                                <p:outputLabel value="#{history.readableState}"/>
                            </p:column>

                            <p:column headerText="App.Date">
                                <h:outputLabel value="#{history.appointment.appointment_Date}">

                                </h:outputLabel>
                            </p:column>

                            <p:column headerText="Time" filterable="true">
                                <p:outputLabel value="#{fileDetailsBean.getLocalizedDate(history.createdAt)}">
                                    <f:convertDateTime  pattern="d-M-yyyy hh:mm"/>
                                </p:outputLabel>
                            </p:column>

                            <p:column headerText="Action By..." filterable="true" filterMatchMode="contains">

                                <p:outputLabel value="#{history.owner.getfullName()}"/>

                            </p:column>

                        </p:dataTable>

                    </p:panel>


                </h:panelGrid>

            </h:form>


        </ui:define>

    </ui:composition>

</f:view>
</html>
